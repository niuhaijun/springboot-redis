# 一：持久化
## 1、rdb持久化



---
## 2、aof持久化



---

# 二：持久化和复制功能对过期键的处理
## 1、`rbd`对过期键的处理
* 生成rdb文件：执行`save`命令和`bgsave`命令创建一个新rbd文件时，已过期的键不会被保存到新创建的rdb文件中
* 载入rdb文件：启动redis时，服务器开启了rdb功能，服务器将载入rdb文件
    * 服务器以`主服务器模式`运行，载入rdb文件时，程序只会保留未过期的键
    * 服务器以`从服务器模式`运行，载入rdb文件时，程序会保留所有键。主从服务器在进行数据同步的时候，从服务器的数据库会被清空。
---
## 2、`aof`对过期键的处理
* aof文件写入：当过期键被删除时，程序回向aof文件追加一条del命令，显示记录该键被删除
* aof重写：在执行aof重写时，已过期的键不会被保存到重写后的aof文件中
---
## 3、`复制`对过期键的处理：
* 当服务器运行在`复制模式`下时，从服务器的过期键删除动作由`主服务器`控制
* 主服务器在删除一个过期键之后，会显式地向所有从服务器发送一个DEL命令，告知从服务器删除这个过期键；
* 从服务器在执行客户端发送的读命令时，即使碰到过期键也不会将过期键删除，而是继续像处理未过期的键一样来处理过期键；
* 从服务器只有在接到主服务器发来的DEL命令之后，才会删除过期键。
* 目的：主服务器控制从服务器统一删除过期键，保证主从服务器数据一致性。
---
